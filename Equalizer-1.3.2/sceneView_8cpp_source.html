<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Equalizer: sceneView.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Equalizer
   &#160;<span id="projectnumber">1.3.2-git</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_a16302d6fb6e05c248bb6b6a2ee1f05a.html">install</a>      </li>
      <li class="navelem"><a class="el" href="dir_3f33c52f45b784a869a3b56200a5c9ce.html">share</a>      </li>
      <li class="navelem"><a class="el" href="dir_19f7e917aff2bd49489de1f9fed97fee.html">Equalizer</a>      </li>
      <li class="navelem"><a class="el" href="dir_ae541b2268646b2cb2a5a02fcd782a77.html">examples</a>      </li>
      <li class="navelem"><a class="el" href="dir_f291ac712d2a73c4ed8000d60a76a9a7.html">osgScaleViewer</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">sceneView.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">/* -*-c++-*- OpenSceneGraph - Copyright (C) 1998-2006 Robert Osfield </span>
<a name="l00003"></a>00003 <span class="comment"> *                           2010-2011 Stefan Eilemann &lt;eile@eyescale.ch&gt;</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This library is open source and may be redistributed and/or modified under  </span>
<a name="l00006"></a>00006 <span class="comment"> * the terms of the OpenSceneGraph Public License (OSGPL) version 0.0 or </span>
<a name="l00007"></a>00007 <span class="comment"> * (at your option) any later version.  The full license is in LICENSE file</span>
<a name="l00008"></a>00008 <span class="comment"> * included with this distribution, and on the openscenegraph.org website.</span>
<a name="l00009"></a>00009 <span class="comment"> * </span>
<a name="l00010"></a>00010 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the </span>
<a name="l00013"></a>00013 <span class="comment"> * OpenSceneGraph Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment">*/</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;sceneView.h&quot;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;osgUtil/UpdateVisitor&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;osgUtil/GLObjectsVisitor&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;osg/Version&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;osg/Timer&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;osg/GLExtensions&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;osg/GLObjects&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;osg/Notify&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;osg/Texture&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;osg/AlphaFunc&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;osg/TexEnv&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;osg/ColorMatrix&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;osg/LightModel&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;osg/CollectOccludersVisitor&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;osg/GLU&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;iterator&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">using namespace </span>osg;
<a name="l00037"></a>00037 <span class="keyword">using namespace </span>osgUtil;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="keyword">namespace </span>osgScaleViewer
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a097e9c408cab70fec15cb2577a450044">00042</a> SceneView::SceneView( osg::DisplaySettings* ds)
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044     _displaySettings = ds;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     _lightingMode=NO_SCENEVIEW_LIGHT;
<a name="l00047"></a>00047     
<a name="l00048"></a>00048     _prioritizeTextures = <span class="keyword">false</span>;
<a name="l00049"></a>00049     
<a name="l00050"></a>00050     setCamera(<span class="keyword">new</span> Camera);
<a name="l00051"></a>00051     _camera-&gt;setViewport(<span class="keyword">new</span> Viewport);
<a name="l00052"></a>00052     _camera-&gt;setClearColor(osg::Vec4(0.2f, 0.2f, 0.4f, 1.0f));
<a name="l00053"></a>00053     
<a name="l00054"></a>00054     _initCalled = <span class="keyword">false</span>;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056     _camera-&gt;setDrawBuffer(GL_BACK);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058     _requiresFlush = <span class="keyword">true</span>;
<a name="l00059"></a>00059     
<a name="l00060"></a>00060     _activeUniforms = DEFAULT_UNIFORMS;
<a name="l00061"></a>00061     
<a name="l00062"></a>00062     _previousFrameTime = 0;
<a name="l00063"></a>00063     _previousSimulationTime = 0;
<a name="l00064"></a>00064     
<a name="l00065"></a>00065     _dynamicObjectCount = 0;
<a name="l00066"></a>00066 }
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 SceneView::SceneView(<span class="keyword">const</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html" title="Based on osgUtil::SceneView, but stripped done to only render and not interfere with stereo setup...">SceneView</a>&amp; rhs, <span class="keyword">const</span> osg::CopyOp&amp; copyop):
<a name="l00069"></a>00069     osg::Object(rhs,copyop),
<a name="l00070"></a>00070     osg::CullSettings(rhs)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072     _displaySettings = rhs._displaySettings;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     _lightingMode = rhs._lightingMode;
<a name="l00075"></a>00075     
<a name="l00076"></a>00076     _prioritizeTextures = rhs._prioritizeTextures;
<a name="l00077"></a>00077     
<a name="l00078"></a>00078     _camera = rhs._camera;
<a name="l00079"></a>00079     _cameraWithOwnership = rhs._cameraWithOwnership;
<a name="l00080"></a>00080     
<a name="l00081"></a>00081     _initCalled = <span class="keyword">false</span>;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     _requiresFlush = rhs._requiresFlush;
<a name="l00084"></a>00084     
<a name="l00085"></a>00085     _activeUniforms = rhs._activeUniforms;
<a name="l00086"></a>00086     
<a name="l00087"></a>00087     _previousFrameTime = 0;
<a name="l00088"></a>00088     _previousSimulationTime = 0;
<a name="l00089"></a>00089     
<a name="l00090"></a>00090     _dynamicObjectCount = 0;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 SceneView::~SceneView()
<a name="l00094"></a>00094 {
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a3e6940098eff6665e2b421efdce9d651">00098</a> <span class="keywordtype">void</span> SceneView::setDefaults(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> options)
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100     osg::CullSettings::setDefaults();
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     _camera-&gt;getProjectionMatrix().makePerspective(50.0f,1.4f,1.0f,10000.0f);
<a name="l00103"></a>00103     _camera-&gt;getViewMatrix().makeIdentity();
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keywordflow">if</span> (!_globalStateSet) _globalStateSet = <span class="keyword">new</span> osg::StateSet;
<a name="l00106"></a>00106     <span class="keywordflow">else</span> _globalStateSet-&gt;clear();
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="keywordflow">if</span> ((options &amp; HEADLIGHT) || (options &amp; SKY_LIGHT))
<a name="l00109"></a>00109     {
<a name="l00110"></a>00110 <span class="preprocessor">        #if defined(OSG_GL_FIXED_FUNCTION_AVAILABLE)</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>            _lightingMode=(options&amp;HEADLIGHT) ? HEADLIGHT : SKY_LIGHT;
<a name="l00112"></a>00112             _light = <span class="keyword">new</span> osg::Light;
<a name="l00113"></a>00113             _light-&gt;setLightNum(0);
<a name="l00114"></a>00114             _light-&gt;setAmbient(Vec4(0.00f,0.0f,0.00f,1.0f));
<a name="l00115"></a>00115             _light-&gt;setDiffuse(Vec4(0.8f,0.8f,0.8f,1.0f));
<a name="l00116"></a>00116             _light-&gt;setSpecular(Vec4(1.0f,1.0f,1.0f,1.0f));
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00119"></a>00119             _globalStateSet-&gt;setAssociatedModes(_light.get(),osg::StateAttribute::ON);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121             <span class="comment">// enable lighting by default.</span>
<a name="l00122"></a>00122             _globalStateSet-&gt;setMode(GL_LIGHTING, osg::StateAttribute::ON);
<a name="l00123"></a>00123 <span class="preprocessor">        #endif</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>        
<a name="l00125"></a>00125 <span class="preprocessor">        #if !defined(OSG_GLES1_AVAILABLE) &amp;&amp; !defined(OSG_GLES2_AVAILABLE) &amp;&amp; defined(OSG_GL_FIXED_FUNCTION_AVAILABLE)</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>            osg::LightModel* lightmodel = <span class="keyword">new</span> osg::LightModel;
<a name="l00127"></a>00127             lightmodel-&gt;setAmbientIntensity(osg::Vec4(0.1f,0.1f,0.1f,1.0f));
<a name="l00128"></a>00128             _globalStateSet-&gt;setAttributeAndModes(lightmodel, osg::StateAttribute::ON);
<a name="l00129"></a>00129 <span class="preprocessor">        #endif</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>    }
<a name="l00131"></a>00131     <span class="keywordflow">else</span>
<a name="l00132"></a>00132     {
<a name="l00133"></a>00133         _lightingMode = NO_SCENEVIEW_LIGHT;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135  
<a name="l00136"></a>00136     _renderInfo.setState(<span class="keyword">new</span> State);
<a name="l00137"></a>00137     
<a name="l00138"></a>00138     _stateGraph = <span class="keyword">new</span> StateGraph;
<a name="l00139"></a>00139     _renderStage = <span class="keyword">new</span> RenderStage;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <span class="keywordflow">if</span> (options &amp; COMPILE_GLOBJECTS_AT_INIT)
<a name="l00143"></a>00143     {
<a name="l00144"></a>00144         GLObjectsVisitor::Mode  dlvMode = GLObjectsVisitor::COMPILE_DISPLAY_LISTS |
<a name="l00145"></a>00145                                           GLObjectsVisitor::COMPILE_STATE_ATTRIBUTES | 
<a name="l00146"></a>00146                                           GLObjectsVisitor::CHECK_BLACK_LISTED_MODES;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="preprocessor">    #ifdef __sgi</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>        dlvMode = GLObjectsVisitor::COMPILE_STATE_ATTRIBUTES;
<a name="l00150"></a>00150 <span class="preprocessor">    #endif</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>
<a name="l00152"></a>00152         <span class="comment">// sgi&#39;s IR graphics has a problem with lighting and display lists, as it seems to store </span>
<a name="l00153"></a>00153         <span class="comment">// lighting state with the display list, and the display list visitor doesn&#39;t currently apply</span>
<a name="l00154"></a>00154         <span class="comment">// state before creating display lists. So will disable the init visitor default, this won&#39;t</span>
<a name="l00155"></a>00155         <span class="comment">// affect functionality since the display lists will be created as and when needed.</span>
<a name="l00156"></a>00156         GLObjectsVisitor* dlv = <span class="keyword">new</span> GLObjectsVisitor(dlvMode);
<a name="l00157"></a>00157         dlv-&gt;setNodeMaskOverride(0xffffffff);
<a name="l00158"></a>00158         _initVisitor = dlv;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161     
<a name="l00162"></a>00162     _updateVisitor = <span class="keyword">new</span> UpdateVisitor;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     _cullVisitor = CullVisitor::create();
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     _cullVisitor-&gt;setStateGraph(_stateGraph.get());
<a name="l00167"></a>00167     _cullVisitor-&gt;setRenderStage(_renderStage.get());
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     _globalStateSet-&gt;setGlobalDefaults();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="preprocessor">    #if defined(OSG_GL_FIXED_FUNCTION_AVAILABLE)</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>        <span class="comment">// set up an texture environment by default to speed up blending operations.</span>
<a name="l00173"></a>00173          osg::TexEnv* texenv = <span class="keyword">new</span> osg::TexEnv;
<a name="l00174"></a>00174          texenv-&gt;setMode(osg::TexEnv::MODULATE);
<a name="l00175"></a>00175          _globalStateSet-&gt;setTextureAttributeAndModes(0,texenv, osg::StateAttribute::ON);
<a name="l00176"></a>00176 <span class="preprocessor">    #endif</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>         
<a name="l00178"></a>00178     _camera-&gt;setClearColor(osg::Vec4(0.2f, 0.2f, 0.4f, 1.0f));
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#af3b8f262d4830de86b8319caa269d280">00181</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#af3b8f262d4830de86b8319caa269d280" title="Set the camera used to represent the camera view of this SceneView.">SceneView::setCamera</a>(osg::Camera* camera, <span class="keywordtype">bool</span> assumeOwnershipOfCamera)
<a name="l00182"></a>00182 {
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (camera)
<a name="l00184"></a>00184     {
<a name="l00185"></a>00185         _camera = camera;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     <span class="keywordflow">else</span>
<a name="l00188"></a>00188     {
<a name="l00189"></a>00189         osg::notify(osg::NOTICE)&lt;&lt;<span class="stringliteral">&quot;Warning: attempt to assign a NULL camera to SceneView not permitted.&quot;</span>&lt;&lt;std::endl;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191     
<a name="l00192"></a>00192     <span class="keywordflow">if</span> (assumeOwnershipOfCamera)
<a name="l00193"></a>00193     {
<a name="l00194"></a>00194         _cameraWithOwnership = _camera.get();
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196     <span class="keywordflow">else</span>
<a name="l00197"></a>00197     {
<a name="l00198"></a>00198         _cameraWithOwnership = 0;
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#aea86b83d0b910570a8061f623b5384bb">00202</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#aea86b83d0b910570a8061f623b5384bb" title="Set the data to view.">SceneView::setSceneData</a>(osg::Node* node)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204     <span class="comment">// take a temporary reference to node to prevent the possibility</span>
<a name="l00205"></a>00205     <span class="comment">// of it getting deleted when when we do the camera clear of children. </span>
<a name="l00206"></a>00206     osg::ref_ptr&lt;osg::Node&gt; temporaryRefernce = node;
<a name="l00207"></a>00207     
<a name="l00208"></a>00208     <span class="comment">// remove pre existing children</span>
<a name="l00209"></a>00209     _camera-&gt;removeChildren(0, _camera-&gt;getNumChildren());
<a name="l00210"></a>00210     
<a name="l00211"></a>00211     <span class="comment">// add the new one in.</span>
<a name="l00212"></a>00212     _camera-&gt;addChild(node);
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#acd5aaeeb0593b1d24d15340f4456e7f4">00215</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#acd5aaeeb0593b1d24d15340f4456e7f4" title="Do init traversal of attached scene graph using Init NodeVisitor.">SceneView::init</a>()
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217     _initCalled = <span class="keyword">true</span>;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="comment">// force the initialization of the OpenGL extension string</span>
<a name="l00220"></a>00220     <span class="comment">// to try and work around a Windows NVidia driver bug circa Oct 2006.</span>
<a name="l00221"></a>00221     osg::isGLExtensionSupported(_renderInfo.getState()-&gt;getContextID(),<span class="stringliteral">&quot;&quot;</span>);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (_camera.valid() &amp;&amp; _initVisitor.valid())
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225         _initVisitor-&gt;reset();
<a name="l00226"></a>00226         _initVisitor-&gt;setFrameStamp(_frameStamp.get());
<a name="l00227"></a>00227         
<a name="l00228"></a>00228         GLObjectsVisitor* dlv = <span class="keyword">dynamic_cast&lt;</span>GLObjectsVisitor*<span class="keyword">&gt;</span>(_initVisitor.get());
<a name="l00229"></a>00229         <span class="keywordflow">if</span> (dlv) dlv-&gt;setState(_renderInfo.getState());
<a name="l00230"></a>00230         
<a name="l00231"></a>00231         <span class="keywordflow">if</span> (_frameStamp.valid())
<a name="l00232"></a>00232         {
<a name="l00233"></a>00233              _initVisitor-&gt;setTraversalNumber(_frameStamp-&gt;getFrameNumber());
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235         
<a name="l00236"></a>00236         _camera-&gt;accept(*_initVisitor.get());
<a name="l00237"></a>00237         
<a name="l00238"></a>00238     } 
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="keywordtype">void</span> SceneView::updateUniforms()
<a name="l00242"></a>00242 {
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (!_localStateSet)
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245         _localStateSet = <span class="keyword">new</span> osg::StateSet;
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (!_localStateSet) <span class="keywordflow">return</span>;
<a name="l00249"></a>00249     
<a name="l00250"></a>00250     <span class="keywordflow">if</span> ((_activeUniforms &amp; FRAME_NUMBER_UNIFORM) &amp;&amp; _frameStamp.valid())
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252 <span class="preprocessor">#if OSG_MIN_VERSION_REQUIRED(2,9,11)</span>
<a name="l00253"></a>00253 <span class="preprocessor"></span>        osg::Uniform* uniform = _localStateSet-&gt;getOrCreateUniform(<span class="stringliteral">&quot;osg_FrameNumber&quot;</span>,osg::Uniform::UNSIGNED_INT);
<a name="l00254"></a>00254 <span class="preprocessor">#else</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>        osg::Uniform* uniform = _localStateSet-&gt;getOrCreateUniform(<span class="stringliteral">&quot;osg_FrameNumber&quot;</span>,osg::Uniform::INT);
<a name="l00256"></a>00256 <span class="preprocessor">#endif</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span>
<a name="l00258"></a>00258         uniform-&gt;set(_frameStamp-&gt;getFrameNumber());        
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     
<a name="l00261"></a>00261     <span class="keywordflow">if</span> ((_activeUniforms &amp; FRAME_TIME_UNIFORM) &amp;&amp; _frameStamp.valid())
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263         osg::Uniform* uniform = _localStateSet-&gt;getOrCreateUniform(<span class="stringliteral">&quot;osg_FrameTime&quot;</span>,osg::Uniform::FLOAT);
<a name="l00264"></a>00264         uniform-&gt;set(static_cast&lt;float&gt;(_frameStamp-&gt;getReferenceTime()));
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266     
<a name="l00267"></a>00267     <span class="keywordflow">if</span> ((_activeUniforms &amp; DELTA_FRAME_TIME_UNIFORM) &amp;&amp; _frameStamp.valid())
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269         <span class="keywordtype">float</span> delta_frame_time = (_previousFrameTime != 0.0) ? <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(_frameStamp-&gt;getReferenceTime()-_previousFrameTime) : 0.0f;
<a name="l00270"></a>00270         _previousFrameTime = _frameStamp-&gt;getReferenceTime();
<a name="l00271"></a>00271         
<a name="l00272"></a>00272         osg::Uniform* uniform = _localStateSet-&gt;getOrCreateUniform(<span class="stringliteral">&quot;osg_DeltaFrameTime&quot;</span>,osg::Uniform::FLOAT);
<a name="l00273"></a>00273         uniform-&gt;set(delta_frame_time);
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     
<a name="l00276"></a>00276     <span class="keywordflow">if</span> ((_activeUniforms &amp; SIMULATION_TIME_UNIFORM) &amp;&amp; _frameStamp.valid())
<a name="l00277"></a>00277     {
<a name="l00278"></a>00278         osg::Uniform* uniform = _localStateSet-&gt;getOrCreateUniform(<span class="stringliteral">&quot;osg_SimulationTime&quot;</span>,osg::Uniform::FLOAT);
<a name="l00279"></a>00279         uniform-&gt;set(static_cast&lt;float&gt;(_frameStamp-&gt;getSimulationTime()));
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     
<a name="l00282"></a>00282     <span class="keywordflow">if</span> ((_activeUniforms &amp; DELTA_SIMULATION_TIME_UNIFORM) &amp;&amp; _frameStamp.valid())
<a name="l00283"></a>00283     {
<a name="l00284"></a>00284         <span class="keywordtype">float</span> delta_simulation_time = (_previousSimulationTime != 0.0) ? <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(_frameStamp-&gt;getSimulationTime()-_previousSimulationTime) : 0.0f;
<a name="l00285"></a>00285         _previousSimulationTime = _frameStamp-&gt;getSimulationTime();
<a name="l00286"></a>00286         
<a name="l00287"></a>00287         osg::Uniform* uniform = _localStateSet-&gt;getOrCreateUniform(<span class="stringliteral">&quot;osg_DeltaSimulationTime&quot;</span>,osg::Uniform::FLOAT);
<a name="l00288"></a>00288         uniform-&gt;set(delta_simulation_time);
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290     
<a name="l00291"></a>00291     <span class="keywordflow">if</span> (_activeUniforms &amp; VIEW_MATRIX_UNIFORM)
<a name="l00292"></a>00292     {
<a name="l00293"></a>00293         osg::Uniform* uniform = _localStateSet-&gt;getOrCreateUniform(<span class="stringliteral">&quot;osg_ViewMatrix&quot;</span>,osg::Uniform::FLOAT_MAT4);
<a name="l00294"></a>00294         uniform-&gt;set(<a class="code" href="classosgScaleViewer_1_1SceneView.html#a6bf52bad3af0e091e3b30c46bb69a1b4" title="Get the view matrix.">getViewMatrix</a>());
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (_activeUniforms &amp; VIEW_MATRIX_INVERSE_UNIFORM)
<a name="l00298"></a>00298     {
<a name="l00299"></a>00299         osg::Uniform* uniform = _localStateSet-&gt;getOrCreateUniform(<span class="stringliteral">&quot;osg_ViewMatrixInverse&quot;</span>,osg::Uniform::FLOAT_MAT4);
<a name="l00300"></a>00300         uniform-&gt;set(osg::Matrix::inverse(<a class="code" href="classosgScaleViewer_1_1SceneView.html#a6bf52bad3af0e091e3b30c46bb69a1b4" title="Get the view matrix.">getViewMatrix</a>()));
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 <span class="keywordtype">void</span> SceneView::setLightingMode(LightingMode mode)
<a name="l00306"></a>00306 {
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (mode==_lightingMode) <span class="keywordflow">return</span>;
<a name="l00308"></a>00308     
<a name="l00309"></a>00309     <span class="keywordflow">if</span> (_lightingMode!=NO_SCENEVIEW_LIGHT)
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311         <span class="comment">// remove GL_LIGHTING mode</span>
<a name="l00312"></a>00312         _globalStateSet-&gt;removeMode(GL_LIGHTING);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="keywordflow">if</span> (_light.valid())
<a name="l00315"></a>00315         {
<a name="l00316"></a>00316             _globalStateSet-&gt;removeAssociatedModes(_light.get());
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     _lightingMode = mode;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (_lightingMode!=NO_SCENEVIEW_LIGHT)
<a name="l00324"></a>00324     {
<a name="l00325"></a>00325 <span class="preprocessor">        #if defined(OSG_GL_FIXED_FUNCTION_AVAILABLE)</span>
<a name="l00326"></a>00326 <span class="preprocessor"></span>            <span class="comment">// add GL_LIGHTING mode</span>
<a name="l00327"></a>00327             _globalStateSet-&gt;setMode(GL_LIGHTING, osg::StateAttribute::ON);
<a name="l00328"></a>00328             <span class="keywordflow">if</span> (_light.valid()) 
<a name="l00329"></a>00329             {
<a name="l00330"></a>00330                 _globalStateSet-&gt;setAssociatedModes(_light.get(), osg::StateAttribute::ON);
<a name="l00331"></a>00331             }
<a name="l00332"></a>00332 <span class="preprocessor">        #endif</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span>    }
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a1ac9cdb1a1d05dd36265be82618e3a8b">00336</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a4813c282cc63d31b17abf1ccb015d08d" title="Inherit the local cull settings variable from specified CullSettings object, according to the inherit...">SceneView::inheritCullSettings</a>(<span class="keyword">const</span> osg::CullSettings&amp; settings, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> inheritanceMask)
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338     <span class="keywordflow">if</span> (_camera.valid() &amp;&amp; _camera-&gt;getView()) 
<a name="l00339"></a>00339     {
<a name="l00340"></a>00340         <span class="keywordflow">if</span> (inheritanceMask &amp; osg::CullSettings::LIGHTING_MODE)
<a name="l00341"></a>00341         {
<a name="l00342"></a>00342             LightingMode newLightingMode = _lightingMode;
<a name="l00343"></a>00343         
<a name="l00344"></a>00344             <span class="keywordflow">switch</span>(_camera-&gt;getView()-&gt;getLightingMode())
<a name="l00345"></a>00345             {
<a name="l00346"></a>00346                 <span class="keywordflow">case</span>(osg::View::NO_LIGHT): newLightingMode = NO_SCENEVIEW_LIGHT; <span class="keywordflow">break</span>;
<a name="l00347"></a>00347                 <span class="keywordflow">case</span>(osg::View::HEADLIGHT): newLightingMode = HEADLIGHT; <span class="keywordflow">break</span>;
<a name="l00348"></a>00348                 <span class="keywordflow">case</span>(osg::View::SKY_LIGHT): newLightingMode = SKY_LIGHT; <span class="keywordflow">break</span>;
<a name="l00349"></a>00349             }
<a name="l00350"></a>00350             
<a name="l00351"></a>00351             <span class="keywordflow">if</span> (newLightingMode != _lightingMode)
<a name="l00352"></a>00352             {
<a name="l00353"></a>00353                 setLightingMode(newLightingMode);
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356                 
<a name="l00357"></a>00357         <span class="keywordflow">if</span> (inheritanceMask &amp; osg::CullSettings::LIGHT)
<a name="l00358"></a>00358         {
<a name="l00359"></a>00359             setLight(_camera-&gt;getView()-&gt;getLight());
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362     
<a name="l00363"></a>00363     <a class="code" href="classosgScaleViewer_1_1SceneView.html#a4813c282cc63d31b17abf1ccb015d08d" title="Inherit the local cull settings variable from specified CullSettings object, according to the inherit...">osg::CullSettings::inheritCullSettings</a>(settings, inheritanceMask);
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 
<a name="l00367"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a2a8d4dd6fe81faec1d1e8a1854169221">00367</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a2a8d4dd6fe81faec1d1e8a1854169221" title="Do cull traversal of attached scene graph using Cull NodeVisitor.">SceneView::cull</a>()
<a name="l00368"></a>00368 {
<a name="l00369"></a>00369     _dynamicObjectCount = 0;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (_camera-&gt;getNodeMask()==0) <span class="keywordflow">return</span>;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     _renderInfo.setView(_camera-&gt;getView());
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">// update the active uniforms</span>
<a name="l00376"></a>00376     updateUniforms();
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (!_renderInfo.getState())
<a name="l00379"></a>00379     {
<a name="l00380"></a>00380         osg::notify(osg::INFO) &lt;&lt; <span class="stringliteral">&quot;Warning: no valid osgUtil::SceneView::_state attached, creating a default state automatically.&quot;</span>&lt;&lt; std::endl;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382         <span class="comment">// note the constructor for osg::State will set ContextID to 0 which will be fine to single context graphics</span>
<a name="l00383"></a>00383         <span class="comment">// applications which is ok for most apps, but not multiple context/pipe applications.</span>
<a name="l00384"></a>00384         _renderInfo.setState(<span class="keyword">new</span> osg::State);
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386     
<a name="l00387"></a>00387     osg::State* state = _renderInfo.getState();
<a name="l00388"></a>00388 
<a name="l00389"></a>00389     <span class="keywordflow">if</span> (!_localStateSet)
<a name="l00390"></a>00390     {
<a name="l00391"></a>00391         _localStateSet = <span class="keyword">new</span> osg::StateSet;
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393     
<a name="l00394"></a>00394     <span class="comment">// we in theory should be able to be able to bypass reset, but we&#39;ll call it just incase.</span>
<a name="l00395"></a>00395     <span class="comment">//_state-&gt;reset();</span>
<a name="l00396"></a>00396    
<a name="l00397"></a>00397     state-&gt;setFrameStamp(_frameStamp.get());
<a name="l00398"></a>00398     state-&gt;setDisplaySettings(_displaySettings.get());
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (!_cullVisitor)
<a name="l00402"></a>00402     {
<a name="l00403"></a>00403         osg::notify(osg::INFO) &lt;&lt; <span class="stringliteral">&quot;Warning: no valid osgUtil::SceneView:: attached, creating a default CullVisitor automatically.&quot;</span>&lt;&lt; std::endl;
<a name="l00404"></a>00404         _cullVisitor = CullVisitor::create();
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (!_stateGraph)
<a name="l00407"></a>00407     {
<a name="l00408"></a>00408         osg::notify(osg::INFO) &lt;&lt; <span class="stringliteral">&quot;Warning: no valid osgUtil::SceneView:: attached, creating a global default StateGraph automatically.&quot;</span>&lt;&lt; std::endl;
<a name="l00409"></a>00409         _stateGraph = <span class="keyword">new</span> StateGraph;
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411     <span class="keywordflow">if</span> (!_renderStage)
<a name="l00412"></a>00412     {
<a name="l00413"></a>00413         osg::notify(osg::INFO) &lt;&lt; <span class="stringliteral">&quot;Warning: no valid osgUtil::SceneView::_renderStage attached, creating a default RenderStage automatically.&quot;</span>&lt;&lt; std::endl;
<a name="l00414"></a>00414         _renderStage = <span class="keyword">new</span> RenderStage;
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     _cullVisitor-&gt;setTraversalMask(_cullMask);
<a name="l00418"></a>00418     <span class="keywordtype">bool</span> computeNearFar = <a class="code" href="classosgScaleViewer_1_1SceneView.html#ad3bac6c25f90c56d1e93b4d787f558d6" title="Do cull traversal of attached scene graph using Cull NodeVisitor.">cullStage</a>(<a class="code" href="classosgScaleViewer_1_1SceneView.html#a41b2e3cf1378b6e5e0dce98d5f5c9cc3" title="Get the projection matrix.">getProjectionMatrix</a>(),<a class="code" href="classosgScaleViewer_1_1SceneView.html#a6bf52bad3af0e091e3b30c46bb69a1b4" title="Get the view matrix.">getViewMatrix</a>(),_cullVisitor.get(),_stateGraph.get(),_renderStage.get(),<a class="code" href="classosgScaleViewer_1_1SceneView.html#a7b73e7ab2fb49c1c6d041eefda01b4c0" title="Get the viewport.">getViewport</a>());
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keywordflow">if</span> (computeNearFar)
<a name="l00421"></a>00421     {
<a name="l00422"></a>00422         CullVisitor::value_type zNear = _cullVisitor-&gt;getCalculatedNearPlane();
<a name="l00423"></a>00423         CullVisitor::value_type zFar = _cullVisitor-&gt;getCalculatedFarPlane();
<a name="l00424"></a>00424         _cullVisitor-&gt;clampProjectionMatrix(<a class="code" href="classosgScaleViewer_1_1SceneView.html#a41b2e3cf1378b6e5e0dce98d5f5c9cc3" title="Get the projection matrix.">getProjectionMatrix</a>(),zNear,zFar);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#ad3bac6c25f90c56d1e93b4d787f558d6">00428</a> <span class="keywordtype">bool</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#ad3bac6c25f90c56d1e93b4d787f558d6" title="Do cull traversal of attached scene graph using Cull NodeVisitor.">SceneView::cullStage</a>(<span class="keyword">const</span> osg::Matrixd&amp; projection,<span class="keyword">const</span> osg::Matrixd&amp; modelview,osgUtil::CullVisitor* cullVisitor, osgUtil::StateGraph* rendergraph, osgUtil::RenderStage* renderStage, osg::Viewport *viewport)
<a name="l00429"></a>00429 {
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (!_camera || !viewport) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     osg::ref_ptr&lt;RefMatrix&gt; proj = <span class="keyword">new</span> osg::RefMatrix(projection);
<a name="l00434"></a>00434     osg::ref_ptr&lt;RefMatrix&gt; mv = <span class="keyword">new</span> osg::RefMatrix(modelview);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <span class="comment">// collect any occluder in the view frustum.</span>
<a name="l00437"></a>00437     <span class="keywordflow">if</span> (_camera-&gt;containsOccluderNodes())
<a name="l00438"></a>00438     {
<a name="l00439"></a>00439         <span class="comment">//std::cout &lt;&lt; &quot;Scene graph contains occluder nodes, searching for them&quot;&lt;&lt;std::endl;</span>
<a name="l00440"></a>00440         
<a name="l00441"></a>00441         
<a name="l00442"></a>00442         <span class="keywordflow">if</span> (!_collectOccludersVisitor) _collectOccludersVisitor = <span class="keyword">new</span> osg::CollectOccludersVisitor;
<a name="l00443"></a>00443         
<a name="l00444"></a>00444         _collectOccludersVisitor-&gt;inheritCullSettings(*<span class="keyword">this</span>);
<a name="l00445"></a>00445         
<a name="l00446"></a>00446         _collectOccludersVisitor-&gt;reset();
<a name="l00447"></a>00447         
<a name="l00448"></a>00448         _collectOccludersVisitor-&gt;setFrameStamp(_frameStamp.get());
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         <span class="comment">// use the frame number for the traversal number.</span>
<a name="l00451"></a>00451         <span class="keywordflow">if</span> (_frameStamp.valid())
<a name="l00452"></a>00452         {
<a name="l00453"></a>00453              _collectOccludersVisitor-&gt;setTraversalNumber(_frameStamp-&gt;getFrameNumber());
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456         _collectOccludersVisitor-&gt;pushViewport(viewport);
<a name="l00457"></a>00457         _collectOccludersVisitor-&gt;pushProjectionMatrix(proj.get());
<a name="l00458"></a>00458         _collectOccludersVisitor-&gt;pushModelViewMatrix(mv.get(),osg::Transform::ABSOLUTE_RF);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460         <span class="comment">// traverse the scene graph to search for occluder in there new positions.</span>
<a name="l00461"></a>00461         _collectOccludersVisitor-&gt;traverse(*_camera);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463         _collectOccludersVisitor-&gt;popModelViewMatrix();
<a name="l00464"></a>00464         _collectOccludersVisitor-&gt;popProjectionMatrix();
<a name="l00465"></a>00465         _collectOccludersVisitor-&gt;popViewport();
<a name="l00466"></a>00466         
<a name="l00467"></a>00467         <span class="comment">// sort the occluder from largest occluder volume to smallest.</span>
<a name="l00468"></a>00468         _collectOccludersVisitor-&gt;removeOccludedOccluders();
<a name="l00469"></a>00469         
<a name="l00470"></a>00470         
<a name="l00471"></a>00471         osg::notify(osg::DEBUG_INFO) &lt;&lt; <span class="stringliteral">&quot;finished searching for occluder - found &quot;</span>&lt;&lt;_collectOccludersVisitor-&gt;getCollectedOccluderSet().size()&lt;&lt;std::endl;
<a name="l00472"></a>00472            
<a name="l00473"></a>00473         cullVisitor-&gt;getOccluderList().clear();
<a name="l00474"></a>00474         std::copy(_collectOccludersVisitor-&gt;getCollectedOccluderSet().begin(),_collectOccludersVisitor-&gt;getCollectedOccluderSet().end(), std::back_insert_iterator&lt;CullStack::OccluderList&gt;(cullVisitor-&gt;getOccluderList()));
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476     
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     cullVisitor-&gt;reset();
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     cullVisitor-&gt;setFrameStamp(_frameStamp.get());
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="comment">// use the frame number for the traversal number.</span>
<a name="l00484"></a>00484     <span class="keywordflow">if</span> (_frameStamp.valid())
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486          cullVisitor-&gt;setTraversalNumber(_frameStamp-&gt;getFrameNumber());
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     cullVisitor-&gt;inheritCullSettings(*<span class="keyword">this</span>);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     cullVisitor-&gt;setStateGraph(rendergraph);
<a name="l00492"></a>00492     cullVisitor-&gt;setRenderStage(renderStage);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     cullVisitor-&gt;setRenderInfo( _renderInfo );
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     renderStage-&gt;reset();
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="comment">// comment out reset of rendergraph since clean is more efficient.</span>
<a name="l00499"></a>00499     <span class="comment">//  rendergraph-&gt;reset();</span>
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <span class="comment">// use clean of the rendergraph rather than reset, as it is able to</span>
<a name="l00502"></a>00502     <span class="comment">// reuse the structure on the rendergraph in the next frame. This</span>
<a name="l00503"></a>00503     <span class="comment">// achieves a certain amount of frame cohereancy of memory allocation.</span>
<a name="l00504"></a>00504     rendergraph-&gt;clean();
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     renderStage-&gt;setViewport(viewport);
<a name="l00507"></a>00507     renderStage-&gt;setClearColor(_camera-&gt;getClearColor());
<a name="l00508"></a>00508     renderStage-&gt;setClearDepth(_camera-&gt;getClearDepth());
<a name="l00509"></a>00509     renderStage-&gt;setClearAccum(_camera-&gt;getClearAccum());
<a name="l00510"></a>00510     renderStage-&gt;setClearStencil(_camera-&gt;getClearStencil());
<a name="l00511"></a>00511     renderStage-&gt;setClearMask(_camera-&gt;getClearMask());
<a name="l00512"></a>00512     
<a name="l00513"></a>00513 <span class="preprocessor">#if 1    </span>
<a name="l00514"></a>00514 <span class="preprocessor"></span>    renderStage-&gt;setCamera(_camera.get());
<a name="l00515"></a>00515 <span class="preprocessor">#endif</span>
<a name="l00516"></a>00516 <span class="preprocessor"></span>
<a name="l00517"></a>00517 <span class="preprocessor">    #if defined(OSG_GL_FIXED_FUNCTION_AVAILABLE)</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span>        <span class="keywordflow">switch</span>(_lightingMode)
<a name="l00519"></a>00519         {
<a name="l00520"></a>00520         <span class="keywordflow">case</span>(HEADLIGHT):
<a name="l00521"></a>00521             <span class="keywordflow">if</span> (_light.valid()) renderStage-&gt;addPositionedAttribute(NULL,_light.get());
<a name="l00522"></a>00522             <span class="keywordflow">else</span> osg::notify(osg::WARN)&lt;&lt;<span class="stringliteral">&quot;Warning: no osg::Light attached to ogUtil::SceneView to provide head light.*/&quot;</span>&lt;&lt;std::endl;
<a name="l00523"></a>00523             <span class="keywordflow">break</span>;
<a name="l00524"></a>00524         <span class="keywordflow">case</span>(SKY_LIGHT):
<a name="l00525"></a>00525             <span class="keywordflow">if</span> (_light.valid()) renderStage-&gt;addPositionedAttribute(mv.get(),_light.get());
<a name="l00526"></a>00526             <span class="keywordflow">else</span> osg::notify(osg::WARN)&lt;&lt;<span class="stringliteral">&quot;Warning: no osg::Light attached to ogUtil::SceneView to provide sky light.*/&quot;</span>&lt;&lt;std::endl;
<a name="l00527"></a>00527             <span class="keywordflow">break</span>;
<a name="l00528"></a>00528         <span class="keywordflow">default</span>:
<a name="l00529"></a>00529             <span class="keywordflow">break</span>;
<a name="l00530"></a>00530         }            
<a name="l00531"></a>00531 <span class="preprocessor">    #endif</span>
<a name="l00532"></a>00532 <span class="preprocessor"></span>    
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (_globalStateSet.valid()) cullVisitor-&gt;pushStateSet(_globalStateSet.get());
<a name="l00534"></a>00534     <span class="keywordflow">if</span> (_secondaryStateSet.valid()) cullVisitor-&gt;pushStateSet(_secondaryStateSet.get());
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (_localStateSet.valid()) cullVisitor-&gt;pushStateSet(_localStateSet.get());
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     cullVisitor-&gt;pushViewport(viewport);
<a name="l00539"></a>00539     cullVisitor-&gt;pushProjectionMatrix(proj.get());
<a name="l00540"></a>00540     cullVisitor-&gt;pushModelViewMatrix(mv.get(),osg::Transform::ABSOLUTE_RF);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="comment">// traverse the scene graph to generate the rendergraph.    </span>
<a name="l00543"></a>00543     <span class="comment">// If the camera has a cullCallback execute the callback which has the  </span>
<a name="l00544"></a>00544     <span class="comment">// requirement that it must traverse the camera&#39;s children.</span>
<a name="l00545"></a>00545     {
<a name="l00546"></a>00546        osg::NodeCallback* callback = _camera-&gt;getCullCallback();
<a name="l00547"></a>00547        <span class="keywordflow">if</span> (callback) (*callback)(_camera.get(), cullVisitor);
<a name="l00548"></a>00548        <span class="keywordflow">else</span> cullVisitor-&gt;traverse(*_camera);
<a name="l00549"></a>00549     }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     cullVisitor-&gt;popModelViewMatrix();
<a name="l00553"></a>00553     cullVisitor-&gt;popProjectionMatrix();
<a name="l00554"></a>00554     cullVisitor-&gt;popViewport();
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     <span class="keywordflow">if</span> (_localStateSet.valid()) cullVisitor-&gt;popStateSet();
<a name="l00557"></a>00557     <span class="keywordflow">if</span> (_secondaryStateSet.valid()) cullVisitor-&gt;popStateSet();
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (_globalStateSet.valid()) cullVisitor-&gt;popStateSet();
<a name="l00559"></a>00559     
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     renderStage-&gt;sort();
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <span class="comment">// prune out any empty StateGraph children.</span>
<a name="l00564"></a>00564     <span class="comment">// note, this would be not required if the rendergraph had been</span>
<a name="l00565"></a>00565     <span class="comment">// reset at the start of each frame (see top of this method) but</span>
<a name="l00566"></a>00566     <span class="comment">// a clean has been used instead to try to minimize the amount of</span>
<a name="l00567"></a>00567     <span class="comment">// allocation and deleteing of the StateGraph nodes.</span>
<a name="l00568"></a>00568     rendergraph-&gt;prune();
<a name="l00569"></a>00569     
<a name="l00570"></a>00570     <span class="comment">// set the number of dynamic objects in the scene.    </span>
<a name="l00571"></a>00571     _dynamicObjectCount += renderStage-&gt;computeNumberOfDynamicRenderLeaves();
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     <span class="keywordtype">bool</span> computeNearFar = (cullVisitor-&gt;getComputeNearFarMode()!=osgUtil::CullVisitor::DO_NOT_COMPUTE_NEAR_FAR) &amp;&amp; <a class="code" href="classosgScaleViewer_1_1SceneView.html#aa9587c71e0bda5e7f91df3d75d43ef5c" title="Get the scene data to view.">getSceneData</a>()!=0;
<a name="l00575"></a>00575     <span class="keywordflow">return</span> computeNearFar;
<a name="l00576"></a>00576 }
<a name="l00577"></a>00577 
<a name="l00578"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a918c57900356ca9c2209cd2e311abe89">00578</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a918c57900356ca9c2209cd2e311abe89" title="Release all OpenGL objects from the scene graph, such as texture objects, display lists etc...">SceneView::releaseAllGLObjects</a>()
<a name="l00579"></a>00579 {
<a name="l00580"></a>00580     <span class="keywordflow">if</span> (!_camera) <span class="keywordflow">return</span>;
<a name="l00581"></a>00581    
<a name="l00582"></a>00582     _camera-&gt;releaseGLObjects(_renderInfo.getState());
<a name="l00583"></a>00583     
<a name="l00584"></a>00584     <span class="comment">// we need to reset State as it keeps handles to Program objects.</span>
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (_renderInfo.getState()) _renderInfo.getState()-&gt;reset();
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 
<a name="l00589"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a2756bcd898d6f8d83914eb4906c11fff">00589</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a2756bcd898d6f8d83914eb4906c11fff" title="Flush all deleted OpenGL objects, such as texture objects, display lists etc.">SceneView::flushAllDeletedGLObjects</a>()
<a name="l00590"></a>00590 {
<a name="l00591"></a>00591     _requiresFlush = <span class="keyword">false</span>;
<a name="l00592"></a>00592     
<a name="l00593"></a>00593     <a class="code" href="classosgScaleViewer_1_1SceneView.html#a2756bcd898d6f8d83914eb4906c11fff" title="Flush all deleted OpenGL objects, such as texture objects, display lists etc.">osg::flushAllDeletedGLObjects</a>(getState()-&gt;getContextID());
<a name="l00594"></a>00594  }
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a0691ec1d51f8bf07c9c6227c0b2ae500">00596</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a0691ec1d51f8bf07c9c6227c0b2ae500" title="Flush deleted OpenGL objects, such as texture objects, display lists etc within specified available t...">SceneView::flushDeletedGLObjects</a>(<span class="keywordtype">double</span>&amp; availableTime)
<a name="l00597"></a>00597 {
<a name="l00598"></a>00598     osg::State* state = _renderInfo.getState();
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     _requiresFlush = <span class="keyword">false</span>;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     <span class="keywordtype">double</span> currentTime = state-&gt;getFrameStamp()?state-&gt;getFrameStamp()-&gt;getReferenceTime():0.0;
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <a class="code" href="classosgScaleViewer_1_1SceneView.html#a0691ec1d51f8bf07c9c6227c0b2ae500" title="Flush deleted OpenGL objects, such as texture objects, display lists etc within specified available t...">osg::flushDeletedGLObjects</a>(getState()-&gt;getContextID(), currentTime, availableTime);
<a name="l00605"></a>00605 }
<a name="l00606"></a>00606 
<a name="l00607"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#aa60d2660fd296096da011b898891c237">00607</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#aa60d2660fd296096da011b898891c237" title="Do draw traversal of draw bins generated by cull traversal.">SceneView::draw</a>()
<a name="l00608"></a>00608 {
<a name="l00609"></a>00609     <span class="keywordflow">if</span> (_camera-&gt;getNodeMask()==0) <span class="keywordflow">return</span>;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     osg::State* state = _renderInfo.getState();
<a name="l00612"></a>00612     state-&gt;initializeExtensionProcs();
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     osg::Texture::TextureObjectManager* tom = osg::Texture::getTextureObjectManager(state-&gt;getContextID()).<span class="keyword">get</span>();
<a name="l00615"></a>00615     tom-&gt;newFrame(state-&gt;getFrameStamp());
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     osg::GLBufferObjectManager* bom = osg::GLBufferObjectManager::getGLBufferObjectManager(state-&gt;getContextID()).<span class="keyword">get</span>();
<a name="l00618"></a>00618     bom-&gt;newFrame(state-&gt;getFrameStamp());
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (!_initCalled) <a class="code" href="classosgScaleViewer_1_1SceneView.html#acd5aaeeb0593b1d24d15340f4456e7f4" title="Do init traversal of attached scene graph using Init NodeVisitor.">init</a>();
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     <span class="comment">// note, to support multi-pipe systems the deletion of OpenGL display list</span>
<a name="l00623"></a>00623     <span class="comment">// and texture objects is deferred until the OpenGL context is the correct</span>
<a name="l00624"></a>00624     <span class="comment">// context for when the object were originally created.  Here we know what</span>
<a name="l00625"></a>00625     <span class="comment">// context we are in so can flush the appropriate caches.</span>
<a name="l00626"></a>00626     
<a name="l00627"></a>00627     <span class="keywordflow">if</span> (_requiresFlush)
<a name="l00628"></a>00628     {
<a name="l00629"></a>00629         <span class="keywordtype">double</span> availableTime = 0.005;
<a name="l00630"></a>00630         <a class="code" href="classosgScaleViewer_1_1SceneView.html#a0691ec1d51f8bf07c9c6227c0b2ae500" title="Flush deleted OpenGL objects, such as texture objects, display lists etc within specified available t...">flushDeletedGLObjects</a>(availableTime);
<a name="l00631"></a>00631     }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     <span class="comment">// assume the the draw which is about to happen could generate GL objects that need flushing in the next frame.</span>
<a name="l00634"></a>00634     _requiresFlush = <span class="keyword">true</span>;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     state-&gt;setInitialViewMatrix(<span class="keyword">new</span> osg::RefMatrix(<a class="code" href="classosgScaleViewer_1_1SceneView.html#a6bf52bad3af0e091e3b30c46bb69a1b4" title="Get the view matrix.">getViewMatrix</a>()));
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     RenderLeaf* previous = NULL;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     _localStateSet-&gt;setAttribute(<a class="code" href="classosgScaleViewer_1_1SceneView.html#a7b73e7ab2fb49c1c6d041eefda01b4c0" title="Get the viewport.">getViewport</a>());
<a name="l00641"></a>00641 
<a name="l00642"></a>00642     <span class="comment">// bog standard draw.</span>
<a name="l00643"></a>00643     _renderStage-&gt;drawPreRenderStages(_renderInfo,previous);
<a name="l00644"></a>00644     _renderStage-&gt;draw(_renderInfo,previous);
<a name="l00645"></a>00645     
<a name="l00646"></a>00646     <span class="comment">// re apply the defalt OGL state.</span>
<a name="l00647"></a>00647     state-&gt;popAllStateSets();
<a name="l00648"></a>00648     state-&gt;apply();
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 <span class="preprocessor">#if 0</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (_camera-&gt;getPostDrawCallback())
<a name="l00652"></a>00652     {
<a name="l00653"></a>00653         (*(_camera-&gt;getPostDrawCallback()))(*_camera);
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655 <span class="preprocessor">#endif</span>
<a name="l00656"></a>00656 <span class="preprocessor"></span>
<a name="l00657"></a>00657     <span class="keywordflow">if</span> (state-&gt;getCheckForGLErrors()!=osg::State::NEVER_CHECK_GL_ERRORS)
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659         <span class="keywordflow">if</span> (state-&gt;checkGLErrors(<span class="stringliteral">&quot;end of SceneView::draw()&quot;</span>))
<a name="l00660"></a>00660         {
<a name="l00661"></a>00661             <span class="comment">// go into debug mode of OGL error in a fine grained way to help</span>
<a name="l00662"></a>00662             <span class="comment">// track down OpenGL errors.</span>
<a name="l00663"></a>00663             state-&gt;setCheckForGLErrors(osg::State::ONCE_PER_ATTRIBUTE);
<a name="l00664"></a>00664         }
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667 <span class="comment">// #define REPORT_TEXTURE_MANAGER_STATS</span>
<a name="l00668"></a>00668 <span class="preprocessor">#ifdef REPORT_TEXTURE_MANAGER_STATS</span>
<a name="l00669"></a>00669 <span class="preprocessor"></span>    tom-&gt;reportStats();
<a name="l00670"></a>00670     bom-&gt;reportStats();
<a name="l00671"></a>00671 <span class="preprocessor">#endif</span>
<a name="l00672"></a>00672 <span class="preprocessor"></span>
<a name="l00673"></a>00673     <span class="comment">// osg::notify(osg::NOTICE)&lt;&lt;&quot;SceneView  draw() DynamicObjectCount&quot;&lt;&lt;getState()-&gt;getDynamicObjectCount()&lt;&lt;std::endl;</span>
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 }
<a name="l00676"></a>00676 
<a name="l00681"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#ac8dd2ed1430fa6ac59d904da2fc8aa79">00681</a> <span class="keywordtype">bool</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#ac8dd2ed1430fa6ac59d904da2fc8aa79" title="Calculate the object coordinates of a point in window coordinates.">SceneView::projectWindowIntoObject</a>(<span class="keyword">const</span> osg::Vec3&amp; window,osg::Vec3&amp; <span class="keywordtype">object</span>)<span class="keyword"> const</span>
<a name="l00682"></a>00682 <span class="keyword"></span>{
<a name="l00683"></a>00683     osg::Matrix inverseMVPW;
<a name="l00684"></a>00684     inverseMVPW.invert(computeMVPW());
<a name="l00685"></a>00685     
<a name="l00686"></a>00686     <span class="keywordtype">object</span> = window*inverseMVPW;
<a name="l00687"></a>00687     
<a name="l00688"></a>00688     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00689"></a>00689 }
<a name="l00690"></a>00690 
<a name="l00691"></a>00691 
<a name="l00697"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a9f3fc3780c5468a84658a43bf3a734fb">00697</a> <span class="keywordtype">bool</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a9f3fc3780c5468a84658a43bf3a734fb" title="Calculate the object coordinates of a window x,y when projected onto the near and far planes...">SceneView::projectWindowXYIntoObject</a>(<span class="keywordtype">int</span> x,<span class="keywordtype">int</span> y,osg::Vec3&amp; near_point,osg::Vec3&amp; far_point)<span class="keyword"> const</span>
<a name="l00698"></a>00698 <span class="keyword"></span>{
<a name="l00699"></a>00699     osg::Matrix inverseMVPW;
<a name="l00700"></a>00700     inverseMVPW.invert(computeMVPW());
<a name="l00701"></a>00701     
<a name="l00702"></a>00702     near_point = osg::Vec3(x,y,0.0f)*inverseMVPW;
<a name="l00703"></a>00703     far_point = osg::Vec3(x,y,1.0f)*inverseMVPW;
<a name="l00704"></a>00704         
<a name="l00705"></a>00705     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 
<a name="l00713"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a9422c20cfb5a1de58b1a9af9cfd7ea14">00713</a> <span class="keywordtype">bool</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a9422c20cfb5a1de58b1a9af9cfd7ea14" title="Calculate the window coordinates of a point in object coordinates.">SceneView::projectObjectIntoWindow</a>(<span class="keyword">const</span> osg::Vec3&amp; <span class="keywordtype">object</span>,osg::Vec3&amp; window)<span class="keyword"> const</span>
<a name="l00714"></a>00714 <span class="keyword"></span>{
<a name="l00715"></a>00715     window = <span class="keywordtype">object</span>*computeMVPW();
<a name="l00716"></a>00716     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="keyword">const</span> osg::Matrix SceneView::computeMVPW()<span class="keyword"> const</span>
<a name="l00720"></a>00720 <span class="keyword"></span>{
<a name="l00721"></a>00721     osg::Matrix matrix( <a class="code" href="classosgScaleViewer_1_1SceneView.html#a6bf52bad3af0e091e3b30c46bb69a1b4" title="Get the view matrix.">getViewMatrix</a>() * <a class="code" href="classosgScaleViewer_1_1SceneView.html#a41b2e3cf1378b6e5e0dce98d5f5c9cc3" title="Get the projection matrix.">getProjectionMatrix</a>());
<a name="l00722"></a>00722         
<a name="l00723"></a>00723     <span class="keywordflow">if</span> (<a class="code" href="classosgScaleViewer_1_1SceneView.html#a7b73e7ab2fb49c1c6d041eefda01b4c0" title="Get the viewport.">getViewport</a>())
<a name="l00724"></a>00724         matrix.postMult(<a class="code" href="classosgScaleViewer_1_1SceneView.html#a7b73e7ab2fb49c1c6d041eefda01b4c0" title="Get the viewport.">getViewport</a>()-&gt;computeWindowMatrix());
<a name="l00725"></a>00725     <span class="keywordflow">else</span>
<a name="l00726"></a>00726         osg::notify(osg::WARN)&lt;&lt;<span class="stringliteral">&quot;osg::Matrix SceneView::computeMVPW() - error no viewport attached to SceneView, coords will be computed inccorectly.&quot;</span>&lt;&lt;std::endl;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     <span class="keywordflow">return</span> matrix;
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="keywordtype">void</span> SceneView::clearArea(<span class="keywordtype">int</span> x,<span class="keywordtype">int</span> y,<span class="keywordtype">int</span> width,<span class="keywordtype">int</span> height,<span class="keyword">const</span> osg::Vec4&amp; color)
<a name="l00732"></a>00732 {
<a name="l00733"></a>00733     osg::ref_ptr&lt;osg::Viewport&gt; viewport = <span class="keyword">new</span> osg::Viewport;
<a name="l00734"></a>00734     viewport-&gt;setViewport(x,y,width,height);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     _renderInfo.getState()-&gt;applyAttribute(viewport.get());
<a name="l00737"></a>00737     
<a name="l00738"></a>00738     glScissor( x, y, width, height );
<a name="l00739"></a>00739     glEnable( GL_SCISSOR_TEST );
<a name="l00740"></a>00740     glClearColor( color[0], color[1], color[2], color[3]);
<a name="l00741"></a>00741     glClear( GL_COLOR_BUFFER_BIT);
<a name="l00742"></a>00742     glDisable( GL_SCISSOR_TEST );
<a name="l00743"></a>00743 }
<a name="l00744"></a>00744 
<a name="l00745"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#ae6c0590e0c59b64ec12e87852ab59785">00745</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#ae6c0590e0c59b64ec12e87852ab59785" title="Set to an orthographic projection.">SceneView::setProjectionMatrixAsOrtho</a>(<span class="keywordtype">double</span> left, <span class="keywordtype">double</span> right,
<a name="l00746"></a>00746                                            <span class="keywordtype">double</span> bottom, <span class="keywordtype">double</span> top,
<a name="l00747"></a>00747                                            <span class="keywordtype">double</span> zNear, <span class="keywordtype">double</span> zFar)
<a name="l00748"></a>00748 {
<a name="l00749"></a>00749     <a class="code" href="classosgScaleViewer_1_1SceneView.html#af5c56a2ab11c93d902c448a19d058f2c" title="Set the projection matrix.">setProjectionMatrix</a>(osg::Matrixd::ortho(left, right,
<a name="l00750"></a>00750                                            bottom, top,
<a name="l00751"></a>00751                                            zNear, zFar));
<a name="l00752"></a>00752 }                                           
<a name="l00753"></a>00753 
<a name="l00754"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a3554c38757fc6d16febce21503a7bb6e">00754</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a3554c38757fc6d16febce21503a7bb6e" title="Set to a 2D orthographic projection.">SceneView::setProjectionMatrixAsOrtho2D</a>(<span class="keywordtype">double</span> left, <span class="keywordtype">double</span> right,
<a name="l00755"></a>00755                                              <span class="keywordtype">double</span> bottom, <span class="keywordtype">double</span> top)
<a name="l00756"></a>00756 {
<a name="l00757"></a>00757     <a class="code" href="classosgScaleViewer_1_1SceneView.html#af5c56a2ab11c93d902c448a19d058f2c" title="Set the projection matrix.">setProjectionMatrix</a>(osg::Matrixd::ortho2D(left, right,
<a name="l00758"></a>00758                                              bottom, top));
<a name="l00759"></a>00759 }
<a name="l00760"></a>00760 
<a name="l00761"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a44a99390aa5b8d19368e9806583c1379">00761</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a44a99390aa5b8d19368e9806583c1379" title="Set to a perspective projection.">SceneView::setProjectionMatrixAsFrustum</a>(<span class="keywordtype">double</span> left, <span class="keywordtype">double</span> right,
<a name="l00762"></a>00762                                              <span class="keywordtype">double</span> bottom, <span class="keywordtype">double</span> top,
<a name="l00763"></a>00763                                              <span class="keywordtype">double</span> zNear, <span class="keywordtype">double</span> zFar)
<a name="l00764"></a>00764 {
<a name="l00765"></a>00765     <a class="code" href="classosgScaleViewer_1_1SceneView.html#af5c56a2ab11c93d902c448a19d058f2c" title="Set the projection matrix.">setProjectionMatrix</a>(osg::Matrixd::frustum(left, right,
<a name="l00766"></a>00766                                              bottom, top,
<a name="l00767"></a>00767                                              zNear, zFar));
<a name="l00768"></a>00768 }
<a name="l00769"></a>00769 
<a name="l00770"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#ac113064a9c139fa8eb8e2c20f42a9cb3">00770</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#ac113064a9c139fa8eb8e2c20f42a9cb3" title="Create a symmetrical perspective projection, See OpenGL gluPerspective documentation for further deta...">SceneView::setProjectionMatrixAsPerspective</a>(<span class="keywordtype">double</span> fovy,<span class="keywordtype">double</span> aspectRatio,
<a name="l00771"></a>00771                                                  <span class="keywordtype">double</span> zNear, <span class="keywordtype">double</span> zFar)
<a name="l00772"></a>00772 {
<a name="l00773"></a>00773     <a class="code" href="classosgScaleViewer_1_1SceneView.html#af5c56a2ab11c93d902c448a19d058f2c" title="Set the projection matrix.">setProjectionMatrix</a>(osg::Matrixd::perspective(fovy,aspectRatio,
<a name="l00774"></a>00774                                                  zNear, zFar));
<a name="l00775"></a>00775 }                                      
<a name="l00776"></a>00776 
<a name="l00777"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a7f85cda6f4f1570d35682d78db4d7134">00777</a> <span class="keywordtype">bool</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a7f85cda6f4f1570d35682d78db4d7134" title="Get the orthographic settings of the orthographic projection matrix.">SceneView::getProjectionMatrixAsOrtho</a>(<span class="keywordtype">double</span>&amp; left, <span class="keywordtype">double</span>&amp; right,
<a name="l00778"></a>00778                                            <span class="keywordtype">double</span>&amp; bottom, <span class="keywordtype">double</span>&amp; top,
<a name="l00779"></a>00779                                            <span class="keywordtype">double</span>&amp; zNear, <span class="keywordtype">double</span>&amp; zFar)<span class="keyword"> const</span>
<a name="l00780"></a>00780 <span class="keyword"></span>{
<a name="l00781"></a>00781     <span class="keywordflow">return</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a41b2e3cf1378b6e5e0dce98d5f5c9cc3" title="Get the projection matrix.">getProjectionMatrix</a>().getOrtho(left, right,
<a name="l00782"></a>00782                                        bottom, top,
<a name="l00783"></a>00783                                        zNear, zFar);
<a name="l00784"></a>00784 }
<a name="l00785"></a>00785 
<a name="l00786"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a4eb73173e1568cc8c6f9b673f86a3721">00786</a> <span class="keywordtype">bool</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a4eb73173e1568cc8c6f9b673f86a3721" title="Get the frustum setting of a perspective projection matrix.">SceneView::getProjectionMatrixAsFrustum</a>(<span class="keywordtype">double</span>&amp; left, <span class="keywordtype">double</span>&amp; right,
<a name="l00787"></a>00787                                              <span class="keywordtype">double</span>&amp; bottom, <span class="keywordtype">double</span>&amp; top,
<a name="l00788"></a>00788                                              <span class="keywordtype">double</span>&amp; zNear, <span class="keywordtype">double</span>&amp; zFar)<span class="keyword"> const</span>
<a name="l00789"></a>00789 <span class="keyword"></span>{
<a name="l00790"></a>00790     <span class="keywordflow">return</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a41b2e3cf1378b6e5e0dce98d5f5c9cc3" title="Get the projection matrix.">getProjectionMatrix</a>().getFrustum(left, right,
<a name="l00791"></a>00791                                          bottom, top,
<a name="l00792"></a>00792                                          zNear, zFar);
<a name="l00793"></a>00793 }                                  
<a name="l00794"></a>00794 
<a name="l00795"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#ac56d63dcbcbca7dc1809e57c461a9a51">00795</a> <span class="keywordtype">bool</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#ac56d63dcbcbca7dc1809e57c461a9a51" title="Get the frustum setting of a symmetric perspective projection matrix.">SceneView::getProjectionMatrixAsPerspective</a>(<span class="keywordtype">double</span>&amp; fovy,<span class="keywordtype">double</span>&amp; aspectRatio,
<a name="l00796"></a>00796                                                  <span class="keywordtype">double</span>&amp; zNear, <span class="keywordtype">double</span>&amp; zFar)<span class="keyword"> const</span>
<a name="l00797"></a>00797 <span class="keyword"></span>{
<a name="l00798"></a>00798     <span class="keywordflow">return</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a41b2e3cf1378b6e5e0dce98d5f5c9cc3" title="Get the projection matrix.">getProjectionMatrix</a>().getPerspective(fovy, aspectRatio, zNear, zFar);
<a name="l00799"></a>00799 }                                                 
<a name="l00800"></a>00800 
<a name="l00801"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#ad9ef70da7016df621b20bd3414f63921">00801</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#ad9ef70da7016df621b20bd3414f63921" title="Set to the position and orientation of view matrix, using the same convention as gluLookAt.">SceneView::setViewMatrixAsLookAt</a>(<span class="keyword">const</span> osg::Vec3&amp; eye,<span class="keyword">const</span> osg::Vec3&amp; center,<span class="keyword">const</span> osg::Vec3&amp; up)
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803     <a class="code" href="classosgScaleViewer_1_1SceneView.html#a4196cf081f1e9e33a45698250fc3bdc9" title="Set the view matrix.">setViewMatrix</a>(osg::Matrixd::lookAt(eye,center,up));
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 
<a name="l00806"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a11a3589d534d64afc340b90980facfa3">00806</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a11a3589d534d64afc340b90980facfa3" title="Get to the position and orientation of a modelview matrix, using the same convention as gluLookAt...">SceneView::getViewMatrixAsLookAt</a>(osg::Vec3&amp; eye,osg::Vec3&amp; center,osg::Vec3&amp; up,<span class="keywordtype">float</span> lookDistance)<span class="keyword"> const</span>
<a name="l00807"></a>00807 <span class="keyword"></span>{
<a name="l00808"></a>00808     <a class="code" href="classosgScaleViewer_1_1SceneView.html#a6bf52bad3af0e091e3b30c46bb69a1b4" title="Get the view matrix.">getViewMatrix</a>().getLookAt(eye,center,up,lookDistance);
<a name="l00809"></a>00809 }
<a name="l00810"></a>00810 
<a name="l00811"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#a95e9ffd41243283efa78634e5a9e6df7">00811</a> <span class="keywordtype">bool</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#a95e9ffd41243283efa78634e5a9e6df7" title="Extract stats for current draw list.">SceneView::getStats</a>(osgUtil::Statistics&amp; stats)
<a name="l00812"></a>00812 {
<a name="l00813"></a>00813     <span class="keywordflow">return</span> _renderStage-&gt;getStats(stats);
<a name="l00814"></a>00814 }
<a name="l00815"></a>00815 
<a name="l00816"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#ab0db15d1619e092341fe79dceba37ac0">00816</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#ab0db15d1619e092341fe79dceba37ac0" title="search through any pre and post RenderStage that reference a Camera, and take a reference to each of ...">SceneView::collateReferencesToDependentCameras</a>()
<a name="l00817"></a>00817 {
<a name="l00818"></a>00818     <span class="keywordflow">if</span> (_renderStage.valid()) _renderStage-&gt;collateReferencesToDependentCameras();
<a name="l00819"></a>00819 }
<a name="l00820"></a>00820 
<a name="l00821"></a><a class="code" href="classosgScaleViewer_1_1SceneView.html#ab049a76936b77d6c13211edd237fece7">00821</a> <span class="keywordtype">void</span> <a class="code" href="classosgScaleViewer_1_1SceneView.html#ab049a76936b77d6c13211edd237fece7" title="clear the refence to any any dependent cameras.">SceneView::clearReferencesToDependentCameras</a>()
<a name="l00822"></a>00822 {
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (_renderStage.valid()) _renderStage-&gt;clearReferencesToDependentCameras();
<a name="l00824"></a>00824 }
<a name="l00825"></a>00825 }
</pre></div></div><!-- contents -->
<address style="text-align: right;">
  <small>Generated on Mon Jun 11 2012 09:33:10 for 
    <a href="/index.html"><img src="/images/Equalizer-doxygen.png" 
                               alt="Equalizer" align="middle" 
                               border="0"></a> 1.3.2-git by&nbsp;
    <a href="http://www.doxygen.org/index.html">
      <img src="doxygen.png" alt="doxygen" align="middle" border="0">
    </a> 1.8.0 
  </small>
</address>
</body>
</html>

